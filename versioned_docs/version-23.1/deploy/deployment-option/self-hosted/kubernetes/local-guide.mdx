---
title: Deploy a Redpanda Cluster in Kubernetes for Local Development
---

<head>
    <meta name="title" content="Deploy a Redpanda Cluster in Kubernetes for Local Development | Redpanda Docs"/>
    <meta name="description" content="Set up a local three-broker Redpanda cluster in Kubernetes for development and testing."/>
</head>

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import Versions from '../../../../shared/_versions.mdx'
import InstallRpkHomebrew from "../../../../get-started/shared/_install-rpk-homebrew.mdx"
import InstallRpkLinux from "../../../../get-started/shared/_install-rpk-linux.mdx"
import OperatorNote from "./shared/guides/_operator-note.mdx"
import DeployRedpanda from "./shared/guides/_deploy-redpanda.mdx"
import StartStreaming from "./shared/guides/_start-streaming.mdx"
import NextSteps from "./shared/guides/_next-steps.mdx"
import SuggestedReading from "./shared/guides/_suggested-reading.mdx"


Deploy a local Redpanda cluster with Redpanda Console in Kubernetes using the Helm chart. Then, use rpk both as an internal client and an external client to interact with your Redpanda cluster from the command line.

<OperatorNote/>

## Prerequisites

Before you begin, make sure that you have the correct software for your Kubernetes platform:

<Tabs groupId="kubernetes-platforms">
<TabItem value="all" label="All platforms" default>

* [`kubectl`](https://kubernetes.io/docs/tasks/tools/). Minimum required Kubernetes version: <Versions name="kubernetes"/>

  ```bash
  kubectl version
  ```

* [Helm](https://helm.sh/docs/intro/install/). Minimum required Helm version: <Versions name="helm"/>

  ```bash
  helm version
  ```

</TabItem>
<TabItem value="kind" label="kind">

* [kind](https://kind.sigs.k8s.io/docs/user/quick-start/#installation)

* [Docker](https://docs.docker.com/get-docker/)

</TabItem>
<TabItem value="minikube" label="minikube">

[minikube](https://minikube.sigs.k8s.io/docs/start/)

</TabItem>
</Tabs>

## Create a Kubernetes cluster

In this step, you create one master and three worker nodes: one worker node for each Redpanda broker.

<Tabs groupId="kubernetes-platforms">
<TabItem value="kind" label="kind" default>

1. Define a cluster in the `kind.yaml` configuration file:

  ```bash
  cat <<EOF >kind.yaml
  ---
  apiVersion: kind.x-k8s.io/v1alpha4
  kind: Cluster
  nodes:
    - role: control-plane
    - role: worker
    - role: worker
    - role: worker
  EOF
  ```

1. Create the Kubernetes cluster from the configuration file:

  ```bash
  kind create cluster --config kind.yaml
  ```

</TabItem>
<TabItem value="minikube" label="minikube">

1. Create the Kubernetes cluster:

  ```bash
  minikube start --namespace redpanda --nodes 4
  ```

1. Prevent applications from being scheduled on the Kubernetes control plane node:

  ```bash
  kubectl taint node \
      -l node-role.kubernetes.io/control-plane="" \
      node-role.kubernetes.io/control-plane=:NoSchedule
  ```

</TabItem>
</Tabs>

## Deploy Redpanda

<DeployRedpanda/>

## Deploy Redpanda Console

Redpanda Console is a developer-friendly web UI for managing and debugging your Redpanda cluster and your applications.

Install Redpanda Console using Helm:

```bash
helm repo add redpanda 'https://charts.redpanda.com/'
helm repo update
helm install redpanda-console redpanda/console \
  --namespace redpanda \
  --create-namespace \
  --set console.config.kafka.brokers=redpanda-0.redpanda.redpanda.svc.cluster.local.:9093 \
  --set service.type=NodePort \
  --set service.targetPort=8080
```

- `--namespace redpanda`: Deploy Redpanda Console in the same namespace as your Redpanda cluster so that it can access the brokers using their internal FQDNs.
-  `--set console.config.kafka.brokers=redpanda-0.redpanda.redpanda.svc.cluster.local.:9093`: The Redpanda broker to which Redpanda Console connects to get information from the Redpanda cluster.
- `--set service.type=NodePort`: The Service that Redpanda Console should be exposed to. A NodePort Service allows you to access Redpanda Console from outside Kubernetes.
- `--set service.targetPort=8080` The port on which the Redpanda Console container expects traffic.

## Start streaming

<StartStreaming/>

## Explore your topic in Redpanda Console

1. Find the node port of the Redpanda Console's NodePort Service:

  ```bash
  kubectl get svc redpanda-console -n redpanda
  ```

  <details>
  <summary>
  Example output
  </summary>

  Here, the node port is 30858.

  ```
  NAME               TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE
  redpanda-console   NodePort   10.111.229.17   <none>        8080:30858/TCP   2d19h
  ```

  </details>

1. Find out on which worker node Redpanda Console is running:

  ```bash
  kubectl get pod -n redpanda -o=custom-columns=NODE:.spec.nodeName,NAME:.metadata.name | grep 'redpanda-console'
  ```

  <details>
  <summary>
  Example output
  </summary>

  ```
  worker3   redpanda-console-7bcb56f5f7-56w2h
  ```

  </details>

  
1. Open Redpanda Console in a web browser:

  Replace `<node-ip>` with the IP address of the worker node that's running Redpanda Console.
  Replace `<node-port>` with the node port you found in the previous step.

  ```bash
  http://<node-ip>:<node-port>/brokers
  ```

  All your Redpanda brokers are listed along with their IP addresses and IDs.

1. Go to **Topics** > **twitch_chat**.

  The message that you produced to the topic is displayed along with some other details about the topic.

## Configure external access to the Redpanda brokers

Because external clients are not in the Kubernetes cluster where the Redpanda brokers are running, they cannot resolve the internal addresses of the headless ClusterIP Service.
Instead, Redpanda brokers must also advertise an externally accessible adress that external clients can connect to.

The simplest option for development is to configure the Redpanda brokers to advertise the IP addresses of the worker nodes on which they are running, instead of the default `redpanda-<ordinal-number>.local` hostname.

:::note Only for development and testing
IP addresses can change. If the IP addresses of your LoadBalancer Services change, you must reconfigure the Redpanda brokers and all your external clients with the new IP addresses.
:::

<Tabs groupId="kubernetes-platforms">
<TabItem value="kind" label="kind" default>

<Tabs groupId="operating-systems">
<TabItem value="linux" label="Linux" default>

1. Find the internal IP addresses of all worker nodes in the cluster:

  ```bash
  kubectl get nodes -o wide
  ```

  <details>
  <summary>
  Example output
  </summary>

  ```text
  NAME                 INTERNAL-IP
  kind-control-plane   172.18.0.4
  kind-worker          172.18.0.2
  kind-worker2         172.18.0.3
  kind-worker3         172.18.0.5 
  ```

  </details>

  This example shows three worker nodes with the internal IP addresses `172.18.0.2`, `172.18.0.3`, and `172.18.0.5`.

1. Find out on which worker node each Pod is running:

  ```bash
  kubectl get pods -o wide -n redpanda
  ```

  <details>
  <summary>
  Example output
  </summary>

  ```text
  NAME            NODE
  redpanda-0      kind-worker2
  redpanda-1      kind-worker
  redpanda-2      kind-worker3
  ```

  </details>

  This example shows that the `redpanda-0` Pod is running on the `minikube-m02` worker node. 
  
1. Use the node names to find the internal IP address of the worker node that runs each Pod. For these examples, the result is the following:

  | Redpanda broker | Internal IP |
  |---|---|
  | redpanda-0 | 172.18.0.3 |
  | redpanda-1 | 172.18.0.2 |
  | redpanda-2 | 172.18.0.5 |

  :::note
  Make sure that the internal IP address of the worker node matches the correct Redpanda broker. The worker nodes are not always displayed in the same order as the Pods.
  :::

1. Add entries to `/etc/hosts` file on your local machine for each worker node that's running a Redpanda broker. For example:

  ```bash
  172.18.0.3 redpanda-0.local # kind-worker2
  172.18.0.2 redpanda-1.local # kind-worker
  172.18.0.5 redpanda-2.local # kind-worker3
  ```

1. Install rpk on your local machine, not on a Pod:

  <Tabs>
  <TabItem value="ubuntu" label="Linux" default>

    <InstallRpkLinux/>

  </TabItem>

  <TabItem value="macos" label="macOS">

    <InstallRpkHomebrew/>

  </TabItem>
  </Tabs>

1. Set the `REDPANDA_BROKERS` environment variable to the IP addresses of your worker nodes:

  ```bash
  export REDPANDA_BROKERS=172.18.0.3:31092,172.18.0.2:31092,172.18.0.5:31092
  ```

  :::note
  31092 is the Kafka API port that's exposed by the default NodePort Service.
  :::

1. Get the cluster info:

  ```bash
  rpk cluster info
  ```

  <details>
  <summary>
  Example output
  </summary>

  ```text
  BROKERS
  =======
  ID    HOST              PORT
  0*    redpanda-0.local  31092
  1     redpanda-1.local  31092
  2     redpanda-2.local  31092
  ```

  </details>

</TabItem>
<TabItem value="mac" label="macOS" default>

On macOS, the kind tool is meant for local testing. To test external access, use [GKE](../gke-guide), [EKS](../eks-guide), or [AKS](../aks-guide).

</TabItem>

<TabItem value="windows" label="Windows" default>

On Windows, the kind tool is meant for local testing. To test external access, use [GKE](../gke-guide), [EKS](../eks-guide), or [AKS](../aks-guide).

</TabItem>
</Tabs>

</TabItem>
<TabItem value="minikube" label="minikube">

<Tabs groupId="operating-systems">
<TabItem value="linux" label="Linux" default>

1. Find the internal IP addresses of all worker nodes in the cluster:

  ```bash
  kubectl get nodes -o wide
  ```

  <details>
  <summary>
  Example output
  </summary>

  ```text
  NAME           INTERNAL-IP
  minikube       192.168.49.2
  minikube-m02   192.168.49.3
  minikube-m03   192.168.49.4
  minikube-m04   192.168.49.5
  ```

  </details>

  This example shows three worker nodes with the internal IP addresses `192.168.49.3`, `192.168.49.4`, and `192.168.49.5`.

1. Find out on which worker node each Pod is running:

  ```bash
  kubectl get pods -o wide -n redpanda
  ```

  <details>
  <summary>
  Example output
  </summary>

  ```text
  NAME         NODE
  redpanda-0   minikube-m02
  redpanda-1   minikube-m03
  redpanda-2   minikube-m04
  ```

  </details>

  This example shows that the `redpanda-0` Pod is running on the `minikube-m02` worker node. 
  
1. Use the node names to find the internal IP address of the worker node that runs each Pod. For these examples, the result is the following:

  | Redpanda broker | Internal IP |
  |---|---|
  | redpanda-0 | 192.168.49.3 |
  | redpanda-1 | 192.168.49.4 |
  | redpanda-2 | 192.168.49.5 |

  :::note
  Make sure that the internal IP address of the worker node matches the correct Redpanda broker. The worker nodes are not always displayed in the same order as the Pods.
  :::

1. Add entries to `/etc/hosts` file on your local machine for each worker node that's running a Redpanda broker. For example:

  ```bash
  192.168.49.3 redpanda-0.local # minikube-m02
  192.168.49.4 redpanda-1.local # minikube-m03
  192.168.49.5 redpanda-2.local # minikube-m04
  ```

1. Install rpk on your local machine, not on a Pod:

  <Tabs>
  <TabItem value="ubuntu" label="Linux" default>

    <InstallRpkLinux/>

  </TabItem>

  <TabItem value="macos" label="macOS">

    <InstallRpkHomebrew/>

  </TabItem>
  </Tabs>

1. Set the `REDPANDA_BROKERS` environment variable to the IP addresses of your worker nodes:

  ```bash
  export REDPANDA_BROKERS=192.168.49.3:31092,192.168.49.4:31092,192.168.49.5:31092
  ```

  :::note
  31092 is the Kafka API port that's exposed by the NodePort Service.
  :::

1. Get the cluster info:

  ```bash
  rpk cluster info
  ```

  <details>
  <summary>
  Example output
  </summary>

  ```text
  BROKERS
  =======
  ID    HOST              PORT
  0*    redpanda-0.local  31092
  1     redpanda-1.local  31092
  2     redpanda-2.local  31092
  ```

  </details>

</TabItem>
<TabItem value="mac" label="macOS" default>

On macOS, the minikube tool is meant for local testing. To test external access, use [GKE](../gke-guide), [EKS](../eks-guide), or [AKS](../aks-guide).

</TabItem>

<TabItem value="windows" label="Windows" default>

On Windows, the minikube tool is meant for local testing. To test external access, use [GKE](../gke-guide), [EKS](../eks-guide), or [AKS](../aks-guide).

</TabItem>
</Tabs>
</TabItem>
</Tabs>

## Troubleshooting

### StatefulSet never rolls out

If the StatefulSet Pods remain in a pending state, they may be waiting for resources to become available:

* Make sure that you have a default StorageClass available in your Kubernetes cluster and that the underlying volumes have at least 20Gi of storage capacity.

  ```bash
  kubectl get storageclass
  ```

### dig not defined

`Error: parse error at (redpanda/templates/statefulset.yaml:203): function "dig" not defined`

If you see this error, make sure that you are using the correct version of Helm. See the [Prerequisites](#prerequisites).

## Next steps

<NextSteps/>

## Suggested reading

<SuggestedReading/>