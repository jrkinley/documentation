---
title: Deploy Redpanda in Kubernetes
tags:
  - Kubernetes
---

<head>
    <meta name="title" content="Deploy Redpanda using the Helm Chart | Redpanda Docs"/>
    <meta name="description" content="Use the Redpanda Helm chart to deploy a Redpanda cluster in Kubernetes."/>
</head>

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

This topic describes how to use the Redpanda Helm chart to deploy a Redpanda cluster in Kubernetes.

## Prerequisites

Make sure that your Kubernetes cluster meets the [requirements](../kubernetes-cluster-requirements).

## Deploy Redpanda

1. Add the chart repository to your Helm installation:

  ```bash
  helm repo add redpanda https://charts.redpanda.com/
  ```

1. Update the repository index:

  ```bash
  helm repo update
  ```

1. Install the Redpanda Helm chart:

  ```bash
  helm install redpanda redpanda/redpanda \
    --namespace redpanda \
    --create-namespace
  ```

1. Wait for the Redpanda cluster to be ready:

  ```bash
  kubectl -n redpanda rollout status statefulset redpanda --watch
  ```

  When the Redpanda cluster is ready, the output should look similar to the following:

  ```
  statefulset rolling update complete 3 pods at revision redpanda-8654f645b4...
  ```

1. Verify that each Redpanda broker is scheduled on only one Kubernetes node:

  ```bash
  kubectl get pod -n redpanda  \
  -o=custom-columns=NODE:.spec.nodeName,NAME:.metadata.name -l \
  app.kubernetes.io/component=redpanda,job-name!=redpanda-post-install,job-name!=redpanda-post-upgrade
  ```

  <details>
  <summary>
  Example output
  </summary>
  
  ```
  example-worker3   redpanda-0
  example-worker2   redpanda-1
  example-worker    redpanda-2
  ```

  </details>

## Deploy Redpanda Console

Redpanda Console is a developer-friendly web UI for managing and debugging your Redpanda cluster and your applications.

Install Redpanda Console using Helm:

```bash
helm install redpanda-console redpanda/console \
  --namespace redpanda \
  --create-namespace \
  --set console.config.kafka.brokers=redpanda-0.redpanda.redpanda.svc.cluster.local.:9093 \
  --set service.type=NodePort \
  --set service.targetPort=8080
```

- `--namespace redpanda`: Deploy Redpanda Console in the same namespace as your Redpanda cluster so that it can access the brokers using their [internal FQDNs](#headless-clusterip-service).
-  `--set console.config.kafka.brokers=redpanda-0.redpanda.redpanda.svc.cluster.local.:9093`: The Redpanda broker to which Redpanda Console connects to get information from the Redpanda cluster.
- `--set service.type=NodePort`: The Service that Redpanda Console should be exposed to. A NodePort Service allows you to access Redpanda Console from outside Kubernetes. You can also specify `LoadBalancer` to expose Redpanda Console through a LoadBalancer Service.
- `--set service.targetPort=8080` The port on which the Redpanda Console container expects traffic.

## Explore the default Kubernetes components

Your deployment includes the following components by default:

* [A StatefulSet](#statefulset) with three Pods.
* [One PersistentVolumeClaim](#persistentvolumeclaims) for each Pod, each with a capacity of 20Gi.
* [A headless ClusterIP Service and a NodePort Service](#service) for each Kubernetes node that runs a Redpanda broker.

### StatefulSet

Redpanda is a stateful application. Each Redpanda broker needs to store its own state (topic partitions) in its own storage volume.
As a result, the Helm chart deploys a StatefulSet to manage the Pods in which the Redpanda brokers are running.

```bash
kubectl get statefulset -n redpanda
```

<details>
<summary>
Example output
</summary>

```
NAME       READY   AGE
redpanda   3/3     3m11s
```

</details>

StatefulSets ensure that the state associated with a particular Pod replica is always the same, no matter how often the Pod is recreated.
Each Pod is also given a unique ordinal number in its name such as `redpanda-0`.
A Pod with a particular ordinal number is always associated with a PersistentVolumeClaim with the same number.
When a Pod in the StatefulSet is deleted and recreated, 
it is given the same ordinal number and so it mounts the same storage volume as the deleted Pod that it replaced.

```bash
kubectl get pod -n redpanda
```

<details>
<summary>
Example output
</summary>

```
NAME                              READY   STATUS      RESTARTS        AGE
redpanda-0                        1/1     Running     0               6m9s
redpanda-1                        1/1     Running     0               6m9s
redpanda-2                        1/1     Running     0               6m9s
redpanda-console-5ff45cdb9b-6z2vs 1/1     Running     0               5m
redpanda-post-install-9t5qr       0/1     Completed   0               6m9s
```

:::info
The post-install Job updates the Redpanda runtime configuration.
:::

</details>

### PersistentVolumeClaim

Redpanda brokers must be able to store their data on disk.
By default, the Helm chart uses the default StorageClass in the Kubernetes cluster to create a PersistentVolumeClaim for each Pod.
The default StorageClass in your Kubernetes cluster depends on the Kubernetes platform that you are using.

```bash
kubectl get persistentvolumeclaims -n redpanda
```
<details>
<summary>
Example output
</summary>

```
NAME                 STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE
datadir-redpanda-0   Bound    pvc-3311ade3-de84-4027-80c6-3d8347302962   20Gi       RWO            standard       75s
datadir-redpanda-1   Bound    pvc-4ea8bc03-89a6-41e4-b985-99f074995f08   20Gi       RWO            standard       75s
datadir-redpanda-2   Bound    pvc-45c3555f-43bc-48c2-b209-c284c8091c45   20Gi       RWO            standard       75s
```

</details>

### Service

The clients writing to or reading from a given partition have to connect directly to the leader broker that hosts the partition. 
As a result, clients needs to be able to connect directly to each Pod.
To allow internal and external clients to connect to each Pod that hosts a Redpanda broker, the Helm chart configures two Services:

- Internal using the [Headless ClusterIP](#headless-clusterip-service)
- External using the [NodePort](#nodeport-service)

```bash
kubectl get service -n redpanda
```

<details>
<summary>
Example output
</summary>

```
NAME                TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)                                                       AGE
redpanda            ClusterIP   None            <none>        <none>                                                        5m37s
redpanda-console    NodePort    10.0.251.204    <none>        8080:31635/TCP                                                5m
redpanda-external   NodePort    10.96.137.220   <none>        9644:31644/TCP,9094:31092/TCP,8083:30082/TCP,8080:30081/TCP   5m37s
```

</details>

#### Headless ClusterIP Service

The headless Service associated with a StatefulSet gives the Pods their network identity in the form of a fully qualified domain name (FQDN). Both Redpanda brokers in the same Redpanda cluster and clients within the same Kubernetes cluster use this FQDN to communicate with each other.

:::note
An important requirement of distributed applications such as Redpanda is peer discovery:
The ability for each broker to find other brokers in the same cluster.
When each Pod is rolled out, 
its `seed_servers` field is updated with the FQDN of each Pod in the cluster so that they can discover each other.

```bash
kubectl -n redpanda exec redpanda-0 -c redpanda -- cat etc/redpanda/redpanda.yaml
```

```yaml
redpanda:
    data_directory: /var/lib/redpanda/data
    empty_seed_starts_cluster: false
    
    seed_servers:
        - host:
            address: redpanda-0.redpanda.redpanda.svc.cluster.local.
            port: 33145
        - host:
            address: redpanda-1.redpanda.redpanda.svc.cluster.local.
            port: 33145
        - host:
            address: redpanda-2.redpanda.redpanda.svc.cluster.local.
            port: 33145
```
:::

#### NodePort Service

External access is made available by a NodePort service that opens the following ports by default:

| Node port | Pod port | Purpose |
|---|---|---|
| 30081 | 8081 | Schema registry |
| 30082 | 8083 | HTTP proxy |
| 31092 | 9094 | Kafka API |
| 31644 | 9644 | Admin API |

## Customize the deployment

The Redpanda Helm charts are configured in their `values.yaml` files:

- [Redpanda `values.yaml`](https://artifacthub.io/packages/helm/redpanda-data/redpanda?modal=values)
- [Redpanda Console `values.yaml`](https://artifacthub.io/packages/helm/redpanda-data/console?modal=values)

To customize your deployment, you can override the default values in your own YAML file with the `--values` option or in the command line with the `--set` option.

<Tabs>
<TabItem value="values" label="--values" default>

The `--values` option allows you to keep your overrides in one or more YAML files.

For example, you can create a YAML file and add your overrides to it.

For example, you might override the `storage.persistentVolume.storageClass` configuration in a file called `storage-class.yaml`:

```yaml
storage:
  persistentVolume:
    storageClass: "my-storage-class"
```

The `helm` command to apply this configuration override looks something like the following:

```bash
helm upgrade --install redpanda redpanda/redpanda \
    --namespace redpanda --create-namespace \
    --values storage-class.yaml
```

The values in your YAML file override their counterparts in the Helm chart’s `values.yaml` file. Any values that weren’t overridden keep their defaults.

</TabItem>
<TabItem value="set" label="--set" default>

The `--set` option allows you to specify configuration overrides in the command line.

For example, you might override the `storage.persistentVolume.storageClass` configuration like so:

```bash
helm upgrade --install redpanda redpanda/redpanda \
    --namespace redpanda --create-namespace \
    --set storage.persistentVolume.storageClass=my-storage-class
```

The values in the `--set` options override their counterparts in the Helm chart’s `values.yaml` file. Any values that weren’t overridden keep their defaults.

</TabItem>
</Tabs>

## Find the latest versions of the Redpanda Helm charts

The `helm install` command always pulls the latest version of the chart. To list the current latest version of the Redpanda Helm chart, use the `helm search` command:

```bash
helm search repo redpanda
```

<details>
<summary>
Example output
</summary>

```
NAME             	CHART VERSION	APP VERSION	DESCRIPTION                                      
redpanda/redpanda	2.4.0        	v22.3.9    	Redpanda is the real-time engine for modern apps.
redpanda/console 	0.3.3        	v2.0.2     	Helm chart to deploy Redpanda Console.
```

</details>

To find the versions that are installed on your machine, run the following:

```bash
helm list -n redpanda
```

## Production considerations

If you're deploying Redpanda for production, see the [production best practices](../kubernetes-best-practices). 

## Next steps

See the [Manage Kubernetes topics](../../../../../manage/kubernetes) to learn how to customize the deployment to meet your needs.

