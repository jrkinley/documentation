---
title: Automate Deployment for Production
---

<head>
    <meta name="title" content="Automate Deployment for Production | Redpanda Docs"/>
    <meta name="description" content="Automate Deployment for Production."/>
    <link rel="canonical" href="https://docs.redpanda.com/docs/deploy/deployment-option/self-hosted/manual/production/production-deployment-automation/" />
</head>

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

If you use automation tools like Terraform and Ansible in your environment, you can use them to easily provision a Redpanda cluster for production. Terraform can set up the infrastructure and output a properly-formatted `hosts.ini` file, and Ansible can use that `hosts.ini` file as input to install Redpanda. Or, you can supply your own hosts file (without using Terraform) and use Ansible to install Redpanda.

These steps describe the Redpanda recommended playbook, which includes enabling TLS encryption and Tiered Storage, but you can also download the modules and required role and create your own playbook. For example, if you want to handle your own data directory, you can toggle that part off, and Redpanda just makes sure the permissions are correct. If you want to generate your own security certificates, you can. 

## Use Terraform to set up infrastructure

If you haven't yet installed Terraform, do so following the [Terraform documentation](https://learn.hashicorp.com/tutorials/terraform/install-cli).

1. Clone the `deployment-automation` GitHub repository:

 ```bash
 git clone https://github.com/redpanda-data/deployment-automation.git
 ```

3. Change into the directory:

 ```bash
 cd deployment-automation
 ```

4. Follow the instructions for your preferred cloud provider. The recommended [Terraform registry for Redpanda](https://registry.terraform.io/modules/redpanda-data/redpanda-cluster/aws/latest) deploys VMs on AWS EC2. To create an AWS Redpanda cluster, review and edit the [default variables](https://github.com/redpanda-data/deployment-automation/blob/main/aws/main.tf).

  :::note
  Non-AWS Terraform code is included for [GCP](https://github.com/redpanda-data/deployment-automation/blob/main/gcp/readme.md), [Azure](https://github.com/redpanda-data/deployment-automation/blob/main/azure/README.md), and [IBM Cloud](https://github.com/redpanda-data/deployment-automation/blob/main/ibm/README.md):

  ```bash
  export AWS_ACCESS_KEY_ID=<your-key-ID>
  export AWS_SECRET_ACCESS_KEY=<your-secret-access-key>

  # Go to the cloud provider directory (aws, gcp, azure, or IBM)
  cd aws
  terraform init
  terraform apply --auto-approve
  ```
  :::


<Tabs>
  <TabItem value="aws" label="AWS" default>

  1. Within the `deployment-automation` folder, change into the `aws` directory:

    ```bash
    cd aws
    ```

  2. Set AWS credentials. Terraform provides multiple ways to set the AWS secret and key. See the [Terraform documentation](https://registry.terraform.io/providers/hashicorp/aws/latest/docs#environment-variables).

  3. Initialize Terraform:

    ```bash
    terraform init
    ```

  4. Create the cluster: 
   
    `terraform apply` 
    
    Configuration options:

    | Property      | Description |
    | ----------- | ----------- |
    | `aws_region` | The AWS region to use for deploying the infrastructure. Default: `us-west-2` |
    | `nodes` | The number of brokers to base the cluster on. Default: `3` |
    | `enable_monitoring` | Creates a Prometheus/Grafana instance for monitoring the cluster. Default: `true` |
    | `instance_type` | The instance type on which Redpanda is deployed. Default: `i3.8xlarge` |
    | `prometheus_instance_type` | The instance type on which Prometheus and Grafana are deployed. Default: `c5.2xlarge` |
    | `public_key_path` | Path to the public key of the keypair used to access the brokers. Default: `~/.ssh/id_rsa.pub` |
    | `distro` | Linux distribution to install. (This affects the `distro_` variables.) Default: `ubuntu-focal` |
    | `distro_ami` | AWS AMI to use for each available distribution. These must be changed according to the chosen AWS region. |
    | `distro_ssh_user` | User used to ssh into the created EC2 instances. |
 
    The following example creates a three-broker cluster using i3.large instances:

    ```bash
    terraform apply -var="instance_type=i3.large"
    ```


  </TabItem>

  <TabItem value="gcp" label="GCP">

  1. Within the `deployment-automation` folder, change into the `gcp` directory:

    ```bash
    cd gcp
    ```

  2. You need an existing subnet to deploy the VMs into. The subnet's attached firewall should allow inbound traffic on ports 22, 3000, 8082, 8888, 8889, 9090,  9092, 9644, and 33145. This module adds the `rp-node` tag to the deployed VMs, which can be used as the target tag for the firewall rule.

  3. Initialize Terraform:

    ```bash
    terraform init
    ```

  4. Create the cluster: 
 
    `terraform apply`
   
    Configuration options:
   
    | Property      | Description |
    | ----------- | ----------- |
    | `region` | The region to use for deploying the infrastructure. Default: `us-west1` |
    | `zone` | The region's zone to deploy the infrastructure. Default: `a` |
    | `subnet` | The name of an existing subnet to deploy the infrastructure. |
    | `nodes` | The number of brokers to base the cluster on. Keep in mind that one broker is used as a monitoring broker. Default: `1`|
    | `disks` | The number of local disks to deploy on each machine. Default = `1`|
    | `image` | The OS image running on the VMs. Default: `ubuntu-os-cloud/ubuntu-1804-lts` |
    | `machine_type` | The machine type. Default: `n2-standard-2`|
    | `public_key_path` | Path to the public key of the keypair used to access the brokers. |
    | `ssh_user` | The ssh user. Must match the one in the public ssh key's comments. |

   The following example creates a three-broker cluster using the subnet named `redpanda-cluster-subnet`:

    ```bash
    terraform apply -var nodes=3 -var subnet=redpanda-cluster-subnet -var public_key_path=~/.ssh/id_rsa.pub -var ssh_user=$USER
    ```


  </TabItem>

</Tabs>


### Next steps

Now you can install Redpanda with Ansible or with the [Redpanda installation binary](../../production/production-deployment).

## Use Ansible to install Redpanda

If you haven't yet installed Ansible, do so following the [Ansible documentation](https://docs.ansible.com/ansible/latest/installation_guide/intro_installation.html).

:::note
Depending on your system, you may also need to install Python packages, like SELinux or JMESPath.
:::

1. Clone the `deployment-automation` GitHub repository:

   ```bash
   git clone https://github.com/redpanda-data/deployment-automation.git
   ```

2. Change into the directory:

  ```bash
  cd deployment-automation
  ```

3. Install the roles required by Ansible:

  ```bash
  ansible-galaxy install -r ansible/requirements.yml
  ```

### Configure a hosts file

If you used Terraform to deploy the instances, the `hosts.ini` is updated automatically in the [`artifacts`](https://github.com/redpanda-data/deployment-automation/tree/main/artifacts) directory. 

If you didn't use Terraform, then you must update it manually with a [redpanda] section. 

When you open the file, you see something like the following:

```ini
[redpanda]
ip ansible_user=ssh_user ansible_become=True private_ip=pip id=0
ip ansible_user=ssh_user ansible_become=True private_ip=pip id=1

[monitor]
ip ansible_user=ssh_user ansible_become=True private_ip=pip id=1
```

Under the `[redpanda]` section, replace the following:

| Property      | Description |
| ----------- | ----------- |
| `ip` | The public IP address of the machine. |
| `ansible_user` | The username for Ansible to use to ssh to the machine. |
| `private_ip` | The private IP address of the machine. This could be the same as the public IP address. |
| `id` | The node ID of the Redpanda instance. This must be unique for each host. |

Add additional properties to configure features like rack awareness and Tiered Storage.

The `[monitor]` section is only relevant if you have Prometheus and Grafana installed
on a given host. If you don't want to have this deployed, then remove the
`[monitor]` section.

### Run the Ansible playbook

Use the [Ansible collection for Redpanda](https://galaxy.ansible.com/redpanda/cluster) to build a Redpanda cluster. 

:::note
If you use a playbook to create a cluster, use it for any subsequent operations, like upgrades.
:::

1. From the content root, set `ANSIBLE_COLLECTIONS_PATHS` and `ANSIBLE_ROLES_PATH` for your environment. For example:

  ```bash
  export ANSIBLE_COLLECTIONS_PATHS=${PWD}/artifacts/collections
  export ANSIBLE_ROLES_PATH=${PWD}/artifacts/roles
  ```

2. Install collections and roles:

  ```bash
  ansible-galaxy install -r ./requirements.yml
  ```

3. Set the path to your `hosts.ini` file:
   
 ```bash
 export ANSIBLE_INVENTORY=$PWD/hosts.ini
 ```

4. Run the playbook to set up Redpanda on your selected brokers:

 ```bash
 ansible-playbook --private-key <your-private-key> -i hosts.ini -v ansible/playbooks/provision-node.yml
 ```

After this completes, you have a fully running Redpanda cluster.
