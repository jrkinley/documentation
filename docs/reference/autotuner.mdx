---
title: Redpanda Autotuner
---

<head>
    <meta name="title" content="Redpanda Autotuner Tool | Redpanda Docs"/>
    <meta name="description" content="Redpanda's autotuner tool optimizes the Linux kernel of a production node to maximize performance."/>
</head>

The Redpanda autotuner tool optimizes the performance of your production nodes. It automatically detects the hardware configuration of a node and tunes Linux kernel settings to optimize performance.

:::important
To start your user journey with the autotuner, Redpanda recommends you first follow the guides for production deployment:
- [Deploy for Production](../../deploy/deployment-option/self-hosted/manual/production/production-deployment) 
- [Tune Kubernetes Worker Nodes for Production](../../deploy/deployment-option/self-hosted/kubernetes/kubernetes-tune-workers)

While you follow the guides, consult this reference for details about the autotuner.
:::

The autotuner consists of a set of tuners. Each tuner adjusts a different group of settings, including the following:

- CPU performance for I/O intensive workloads
- Device interrupt request (IRQ) management
- I/O requests and scheduling
- Wiping unused disk blocks
- Choosing a system clock source
- Debuggability and recovery of nodes

## Commands overview

This section provides the fundamental `rpk` commands for using the autotuner.

:::tip
When running `rpk redpanda tune`, make sure that your current Linux user has root privileges. The autotuner requires privileged access to the Linux kernel settings.
:::

- To enable a predetermined set of tuners for production, run the [rpk redpanda mode production](../../reference/rpk/rpk-redpanda/rpk-redpanda-mode) command.

    <details>
        <summary>Enabled features in production mode</summary>
    Enabling production mode sets the following features, including a subset of tuners:

    ```yaml
    redpanda:
        developer_mode: false
    rpk:
        tune_network: true
        tune_disk_scheduler: true
        tune_disk_nomerges: true
        tune_disk_write_cache: true
        tune_disk_irq: true
        tune_cpu: true
        tune_aio_events: true
        tune_clocksource: true
        tune_swappiness: true
        tune_ballast_file: true
        overprovisioned: false
    ``` 
    </details>

- To list the available tuners and to see whether they're enabled or supported (and a reason for if they're unsupported), run the [rpk redpanda tune list](../../reference/rpk/rpk-redpanda/rpk-redpanda-tune-list) command.

- To enable or disable a tuner, run the [rpk redpanda config set](../../reference/rpk/rpk-redpanda/rpk-redpanda-config-set). 
    
    - Each tuner has a YAML key flag for enabling/disabling itself. Most are formed by prepending `rpk.tune_` to the name of the tuner listed by [rpk redpanda tune list](../../reference/rpk/rpk-redpanda/rpk-redpanda-tune-list). See the [Tuners](#tuners) section for the exact YAML key per tuner. For an example of enabling a tuner, the YAML key for the `aio_events` tuner is `rpk.tune_aio_events`, and it can be enabled with the following command:

        ```
        rpk redpanda config set rpk.tune_aio_events true
        ```

- To run all available tuners, use the [rpk redpanda tune](../../reference/rpk/rpk-redpanda/rpk-redpanda-tune) command for all:

    ```
    rpk redpanda tune all
    ```

- To run a specific tuner, use the [rpk redpanda tune](../../reference/rpk/rpk-redpanda/rpk-redpanda-tune) command for the tuner:

    ```
    rpk redpanda tune <tuner-name>
    ```

- To get a help description of a tuner, use the [rpk redpanda tune help](../../reference/rpk/rpk-redpanda/rpk-redpanda-tune-help) command:

    ```
    rpk redpanda tune help <tuner-name>
    ```

For details about the tune command in rpk, see the rpk command references:
- [rpk redpanda tune](../../reference/rpk/rpk-redpanda/rpk-redpanda-tune)
- [rpk redpanda tune list](../../reference/rpk/rpk-redpanda/rpk-redpanda-tune-list)
- [rpk redpanda tune help](../../reference/rpk/rpk-redpanda/rpk-redpanda-tune-help)

## Tuners

This section describes each tuner and their configuration settings in [redpanda.yaml](../../reference/node-configuration-sample). It provides overlapping and additional content to the descriptions returned by [rpk redpanda tune help](../../reference/rpk/rpk-redpanda/rpk-redpanda-tune-help).

### aio_events

The `aio_events` tuner maximizes throughput by increasing the number of simultaneous I/O requests. It sets the maximum number of outstanding asynchronous I/O operations to be above a calculated threshold.

Configuration for the tuner (specified by YAML keys):
- `rpk.tune_aio_events`: flag to enable the tuner (Default for production mode: true)

### ballast_file

The `ballast_file` tuner improves debuggability and recoverability of a system with a full disk by creating a ballast file: if the disk become full, the ballast file can be deleted, thereby allowing the the operating system to boot and the root case to be troubleshooted.

Configuration for the tuner (specified by YAML keys):
- `rpk.tune_ballast_file`: flag to enable the tuner (Default for production mode: true)
- `rpk.ballast_file_size`: size of the ballast file in bytes (Default for production mode: 1 GiB)
- `rpk.ballast_file_path`: path to the ballast file (Default for production mode: `/var/lib/redpanda/data/ballast`)

### clocksource

The `clocksource` tuner improves the performance of getting system time by changing the clock source. It sets the clock source to the Time Stamp Counter (TSC) so time can be read in userspace via the Virtual Dynamic Shared Object (vDSO). This is more efficient than the usual virtual machine clock source, `xen`, that involves the overhead of a system call.

Configuration for the tuner (specified by YAML keys):
- `rpk.tune_clocksource`: flag to enable the tuner (Default for production mode: true)

### coredump

The `coredump` tuner enables coredumps to be saved for production mode. By default, coredumps are not enabled for production. Enabling this tuner sets the location to save coredumps.

Configuration for the tuner (specified by YAML keys):
- `rpk.tune_coredump`: flag to enable the tuner (Default for production mode: false)
- `rpk.coredump_dir`: path to the saved coredump (Default for production mode: `/var/lib/redpanda/coredump`)

### cpu

The `cpu` tuner maximizes CPU performance for I/O intensive workloads by optimizing various CPU settings. It performs the following operations:

- Disables hyper threading
- Sets the ACPI-cpufreq governor to `performance`

If system reboot is allowed (`rpk redpanda tune --reboot-allowed` option is set), the system must be rebooted after the first pass of the tuner, and it performs additional operations:

- Disables hyper threading (via kernel boot parameter)
- Disables Intel P-states
- Disables Intel C-states
- Disables turbo boost

After tuning, the system CPUs operate at the maximum non-turbo frequency.

Configuration for the tuner (specified by YAML keys):
- `rpk.tune_cpu`: flag to enable the tuner (Default for production mode: true)

### disk_irq

The `disk_irq` tuner optimizes the handling of interrupt requests (IRQs) for disks binding all disk IRQs to a requested set of CPUs. It tries to distribute IRQs according to the following guidelines:

- Distribute NVMe disks IRQs equally among all available CPUs.
- Distribute non-NVMe disks IRQs equally among designated CPUs or among all available CPUs in the `mq` mode.

IRQs are distributed according to the operation mode set by `rpk redpanda tune --mode <operation-mode>`. The available operation modes:
- `sq`: set all IRQs of a given disk to CPU0
- `sq_split`: divide all IRQs of a given disk between CPU0 and its HT siblings
- `mq`: distribute disk IRQs among all available CPUs instead of binding them all to CPU0

If no `--mode` is specified, a default mode is determined:
- If there are only NVMe disks, the `mq` mode is set as the default.
- For non-NVMe disks:
    - If the number of HT siblings is less than or equal to four, the `mq` mode is set as the default.
    - Otherwise, if the number of cores is less than or equal to four, the `sq` mode is set as the default.
    - For all other conditions, the `sq_split` mode is set as the default.

Configuration for the tuner (specified by YAML keys):
- `rpk.tune_disk_irq`: flag to enable the tuner (Default for production mode: true)
- `rpk redpanda tune --mode <operation-mode>` sets the IRQ distribution mode


### net

The `net` tuner optimizes the handling of interrupt requests (IRQs) for network interfaces (NICs) by binding all NIC IRQs to a requested set of CPUs.

Its IRQ distribution modes are the same as described for the [disk_irq tuner](#disk_irq).

Configuration for the tuner (specified by YAML keys):
- `rpk.tune_network`: flag to enable the tuner (Default for production mode: true)
- `rpk redpanda tune --mode <operation-mode>` sets the IRQ distribution mode


### disk_nomerges

The `disk_nomerges` tuner reduces CPU overhead by disabling the merging of adjacent I/O requests.

Configuration for the tuner (specified by YAML keys):
- `rpk.tune_disk_nomerges`: flag to enable the tuner (Default for production mode: true)

### disk_scheduler

The `disk_scheduler` tuner optimizes disk scheduler performance for the type of device (NVME, non-NVME). It provides a selectable set of schedulers:

- `none`: minimizes latency of modern NVMe devices by bypassing the operating system's I/O scheduler
- `noop`: preferred for non-NVME devices (and used when `none` is unavailable), this scheduler uses a simple FIFO queue where all I/O operations are first stored and then handled by the driver.

Configuration for the tuner (specified by YAML keys):
- `rpk.tune_disk_scheduler`: flag to enable the tuner (Default for production mode: true)

### disk_write_cache

The `disk_write_cache` tuner optimizes performance in Google Cloud Platform (GCP) by enabling write-through caching for its NVMe `Local SSD` drives.

Configuration for the tuner (specified by YAML keys):
- `rpk.tune_disk_write_cache`: flag to enable the tuner (Default for production mode: true)

### fstrim

The `fstrim` tuner improves SSD performance by starting a background systemd service to periodically wipe memory blocks that are not used by the filesystem. This is desirable for SSDs because they require wiping the space where new data will be written, so not wiping during non-write cycles will eventually cause performance degradations, when the lack of free space results in writes triggering synchronous erasures.

If it's available, the `fstrim` systemd service will be run. If it's unavailable but systemd is available, an equivalent service will be installed and run. Otherwise, no service will be run.

Configuration for the tuner (specified by YAML keys):
- `rpk.tune_fstrim`: flag to enable the tuner (Default for production mode: true)

### transparent_hugepages

The `transparent_hugepages` tuner improves memory page caching by enabling Transparent Huge Pages (THP) for CPUs that support it. Its larger memory pages reduce the number of misses from Translation Lookaside Buffer (TLB) lookups.

Configuration for the tuner (specified by YAML keys):
- `rpk.tune_transparent_hugepages`: flag to enable the tuner (Default for production mode: false)

### swappiness

The `swappiness` tuner tunes the kernel to keep process data in-memory for as long as possible instead of swapping it out to disk.

Configuration for the tuner (specified by YAML keys):
- `rpk.tune_swappiness`: flag to enable the tuner (Default for production mode: true)
