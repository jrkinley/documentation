---
title: Benchmark Redpanda
---

<head>
    <meta name="title" content="Benchmark Redpanda | Redpanda Docs"/>
    <meta name="description" content="Learn how to measure the performance of a Redpanda cluster deployed on AWS EC2 instances with the Linux Foundation's OpenMessaging Benchmark."/>
    <link rel="canonical" href="https://docs.redpanda.com/docs/develop/benchmark/" />
</head>

Learn how to measure the performance of a Redpanda cluster deployed on AWS EC2 instances with the Linux Foundation's OpenMessaging Benchmark.

## About OpenMessaging Benchmark

The [Linux Foundation's OpenMessaging Benchmark](https://openmessaging.cloud/docs/benchmarks/) (OMB) Framework is an open-source, cloud-based benchmark framework that supports several messaging systems, including Kafka, and is configurable for workloads representing real-world use cases.

Redpanda Data provides a [fork of OMB on Github](https://github.com/redpanda-data/openmessaging-benchmark) with some updates:
- Fixed coalescing of asynchronous consumer offset requests in the OMB Kafka driver.
- Support for Kafka 3.2.0 clients. 

### OMB workloads

An OMB workload is a benchmark configuration that sets the producers, consumers, topics, and messages used by a test, as well as the production rate and duration of each test. An OMB workload is specified in a YAML configuration file.

<details>
<summary>Example workload configuration file</summary>

The content of an OMB workload configuration file, copied from Redpanda Data's [fork of OMB](https://github.com/redpanda-data/openmessaging-benchmark/blob/main/workloads/1-topic-1-partition-1kb.yaml):

```
name: 1 topic / 1 partition / 1Kb

topics: 1
partitionsPerTopic: 1
keyDistributor: "NO_KEY"
messageSize: 1024
payloadFile: "payload/payload-1Kb.data"
subscriptionsPerTopic: 1
consumerPerSubscription: 1
producersPerTopic: 1
producerRate: 50000
consumerBacklogSizeGB: 0
testDurationMinutes: 15
```
</details>

## Set up benchmark

Running OMB with Redpanda requires setting up your local environment to provision and start a Redpanda cluster in AWS.

1. Install CLI tools.
    - [Maven](https://maven.apache.org/install.html)
    - [Terraform](https://developer.hashicorp.com/terraform/downloads) with [terraform-inventory plugin](https://github.com/adammck/terraform-inventory)
    - [Ansible](https://docs.ansible.com/ansible/latest/installation_guide/intro_installation.html) (v2.11 or higher)
    - Python 3 and pip
    - (*Recommended*) A window manager like [tmux](https://github.com/tmux/tmux/wiki) or [screen](https://linux.die.net/man/1/screen) that supports detachable screen sessions.   

    :::tip
    Redpanda Data recommends running the benchmark executable with a window manager that supports detachable screen sessions, like tmux or screen, so the benchmark can continue to run in the background even after you disconnect. 
    :::

1. Clone Redpanda Data's fork of OMB.

    ```bash
    git clone https://github.com/redpanda-data/openmessaging-benchmark 
    cd openmessaging-benchmark
    ```

1. Customize your `openmessaging-benchmark/driver-redpanda/pom.xml` file with your Kafka client version if necessary (currently 3.3.1):

    ```xml title="pom.xml"
    ...
    <dependency>
        <groupId>org.apache.kafka</groupId>
        <artifactId>kafka-clients</artifactId>
        <version>3.3.1</version>
    </dependency>
    ...
    ```

1. From `openmessaging-benchmark/`, build the benchmark client.

    ```bash
    mvn clean install -Dlicense.skip=true
    ```

1. Configure AWS credentials and SSH keys.

    1. [Install](https://aws.amazon.com/cli/) and [configure](https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-getting-started.html) AWS CLI.

    1. Generate SSH keys:

        ```bash
        ssh-keygen -f ~/.ssh/redpanda_aws
        ```

        When prompted for a passphrase, set a blank passphrase by pressing <kbd>Enter</kbd> twice.

    1. Verify the SSH key files were created.

        ```bash
        ls ~/.ssh/redpanda_aws*
        ```

1. Provision a Redpanda cluster to deploy on AWS with Terraform.

    1. Customize your `openmessaging-benchmark/deploy/terraform.tfvars` Terraform configuration file for your environment.

       Parameters most likely to change include:
       - `region`
       - `public_key_path`
       - `ami`
       - `instance_types`

       <details>

        <summary>Default Terraform configuration for Redpanda on AWS</summary>

         The default contents of `openmessaging-benchmark/driver-redpanda/deploy/terraform.tfvars`:

         ```text title="terraform.tfvars"
         public_key_path = "~/.ssh/redpanda_aws.pub"
         region          = "us-west-2"
         az		        = "us-west-2a"
         ami             = "ami-0d31d7c9fc9503726"
         profile         = "default"

         instance_types = {
         "redpanda"      = "i3en.6xlarge"
         "client"        = "m5n.8xlarge"
         "prometheus"    = "c5.2xlarge"
         }

         num_instances = {
         "client"     = 4
         "redpanda"   = 3
         "prometheus" = 1
         }
         ```

       </details>

    1. Initialize the Terraform deployment of Redpanda on AWS.

        ```bash
        cd driver-redpanda/deploy
        terraform init
        terraform apply -auto-approve
        ```

        On successful initialization, a confirmation message lists the resources that have been installed.

1. Run the Ansible playbook to install and start the Redpanda cluster.

    Redpanda can run with or without TLS and SASL enabled.
    
    - To run Redpanda **without TLS and SASL**:

        ```bash
        ansible-playbook deploy.yaml
        ```

    - To run Redpanda **with TLS and SASL**:

        ```bash
        ansible-playbook deploy.yaml -e "tls_enabled=true sasl_enabled=true"
        ```

    If the path to your SSH private key isn't `~/.ssh/redpanda_aws`, add the `--private-key` flag to your Ansible command.

    ```bash
    ansible-playbook deploy.yaml --private-key=<private-key-path>
    ```


## Run benchmark

Connect to the benchmark's client and run the benchmark with a custom workload. 

1. Get the IP address of the benchmark client to connect to from Terraform:

    ```bash
    terraform output --raw client_ssh_host
    ```

1. Connect with SSH to the benchmark client with the `client_ssh_host` IP address:

    ```bash
    ssh -i ~/.ssh/redpanda_aws <client-ssh-host-IP-addr>)
    ```

1. On the client, navigate to the `/opt/benchmark` directory.

    ```bash
    cd /opt/benchmark
    ```          

1. Create a workload configuration file.

    ```text
    cat > workloads/1-topic-144-partitions-500mb-4p-4c.yaml << EOF
    name: 500mb/sec rate; 4 producers 4 consumers; 1 topic with 144 partitions

    topics: 1
    partitionsPerTopic: 144

    messageSize: 1024
    useRandomizedPayloads: true
    randomBytesRatio: 0.5
    randomizedPayloadPoolSize: 1000

    subscriptionsPerTopic: 1
    consumerPerSubscription: 4
    producersPerTopic: 4

    producerRate: 500000

    consumerBacklogSizeGB: 0
    testDurationMinutes: 30
    EOF
    ```

1. Run the benchmark with your workload.

    ```bash
    sudo bin/benchmark -d \
    driver-redpanda/redpanda-ack-all-group-linger-1ms.yaml \ 
    workloads/1-topic-144-partitions-500mb-4p-4c.yaml
    ```


## Suggested reading

- [Redpanda vs. Apache Kafka: A performance comparison (2022 update)](https://redpanda.com/blog/redpanda-vs-kafka-performance-benchmark)
